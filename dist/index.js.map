{"version":3,"file":"index.js","sources":["../src/index.js","../src/get-verification-digit.js"],"sourcesContent":["const getVerificationDigit = require('./get-verification-digit');\nconst forbiddenWords = require('./forbidden-words.json');\nconst validRfcs = require('./valid-rfcs.json');\n\nconst RFC_REGEXP = /^([A-ZÑ\\x26]{3,4})([0-9]{6})([A-Z0-9]{3})$/;\nconst INVALID_FORMAT_ERROR = 'INVALID_FORMAT';\nconst INVALID_DATE_ERROR = 'INVALID_DATE';\nconst INVALID_VERIFICATION_DIGIT_ERROR = 'INVALID_VERIFICATION_DIGIT';\nconst FORBIDDEN_WORD_ERROR = 'FORBIDDEN_WORD';\nconst RFC_TYPE_FOR_LENGTH = {\n  '12': 'company',\n  '13': 'person'\n};\nconst SPECIAL_CASES = {\n  'XEXX010101000': 'foreign',\n  'XAXX010101000': 'generic'\n};\n\nconst parseInput = (input) => {\n  return String(input)\n    .trim()\n    .toUpperCase()\n    .replace(/[^0-9A-ZÑ\\x26]/g, '');\n};\n\nconst validateDate = (rfc) => {\n  const dateStr = rfc.slice(0, -3).slice(-6);\n  const year = dateStr.slice(0, 2);\n  const month = dateStr.slice(2, 4);\n  const day = dateStr.slice(4, 6);\n  const date = new Date(`20${year}-${month}-${day}`);\n  return !isNaN(date.getTime());\n};\n\nconst validateVerificationDigit = (rfc) => {\n  const digit = rfc.slice(-1);\n  const expected = getVerificationDigit(rfc);\n  return expected === digit;\n};\n\nconst hasForbiddenWords = (rfc) => {\n  const prefix = (rfc || '').slice(0, 4);\n  return forbiddenWords.includes(prefix);\n};\n\nconst validate = (rfc, { omitVerificationDigit } = {}) => {\n  if (isSpecialCase(rfc) || isValidCase(rfc)) return [];\n  const errors = [];\n  const hasValidFormat = RFC_REGEXP.test(rfc);\n  const hasValidDate = hasValidFormat ? validateDate(rfc) : true;\n  const hasValidDigit = hasValidFormat ? validateVerificationDigit(rfc) : true;\n  if (!hasValidFormat) errors.push(INVALID_FORMAT_ERROR);\n  if (!hasValidDate) errors.push(INVALID_DATE_ERROR);\n  if (!hasValidDigit && !omitVerificationDigit) errors.push(INVALID_VERIFICATION_DIGIT_ERROR);\n  if (hasForbiddenWords(rfc)) errors.push(FORBIDDEN_WORD_ERROR);\n  return errors;\n};\n\nconst isSpecialCase = (rfc) => rfc in SPECIAL_CASES;\n\nconst isValidCase = (rfc) => validRfcs.includes(rfc);\n\nconst getType = (rfc) => SPECIAL_CASES[rfc] || RFC_TYPE_FOR_LENGTH[rfc.length] || null;\n\nconst getValidResponse = (rfc) => ({\n  isValid: true,\n  rfc,\n  type: getType(rfc)\n});\n\nconst getInvalidResponse = (errors) => ({\n  isValid: false,\n  rfc: null,\n  type: null,\n  errors\n});\n\nmodule.exports = (input, options) => {\n  const rfc = parseInput(input);\n  const errors = validate(rfc, options);\n  const isValid = errors.length === 0;\n\n  return isValid ? getValidResponse(rfc) : getInvalidResponse(errors);\n};\n","const VALUES_MAP = {\n  '0': 0,\n  '1': 1,\n  '2': 2,\n  '3': 3,\n  '4': 4,\n  '5': 5,\n  '6': 6,\n  '7': 7,\n  '8': 8,\n  '9': 9,\n  'A': 10,\n  'B': 11,\n  'C': 12,\n  'D': 13,\n  'E': 14,\n  'F': 15,\n  'G': 16,\n  'H': 17,\n  'I': 18,\n  'J': 19,\n  'K': 20,\n  'L': 21,\n  'M': 22,\n  'N': 23,\n  '&': 24,\n  'O': 25,\n  'P': 26,\n  'Q': 27,\n  'R': 28,\n  'S': 29,\n  'T': 30,\n  'U': 31,\n  'V': 32,\n  'W': 33,\n  'X': 34,\n  'Y': 35,\n  'Z': 36,\n  ' ': 37,\n  'Ñ': 38\n};\n\nconst getScore = (string) => string.split('').reverse().reduce((sum, char, i) => {\n  const index = i + 2;\n  const value = VALUES_MAP[char] || 0;\n  return sum + value * index;\n}, 0);\n\nmodule.exports = (input) => {\n  const rfc = input.length === 12 ? ` ${input}` : input;\n  const base = rfc.slice(0, -1);\n  const score = getScore(base);\n  const mod = (11000 - score) % 11;\n  if (mod === 11) return '0';\n  if (mod === 10) return 'A';\n  return String(mod);\n};\n"],"names":["validate","rfc","omitVerificationDigit","isSpecialCase","isValidCase","year","errors","hasValidFormat","RFC_REGEXP","test","hasValidDate","dateStr","slice","month","day","date","Date","isNaN","getTime","hasValidDigit","digit","getVerificationDigit","push","prefix","forbiddenWords","includes","hasForbiddenWords","getValidResponse","isValid","type","SPECIAL_CASES","RFC_TYPE_FOR_LENGTH","length","VALUES_MAP","input","mod","split","reverse","reduce","sum","char","i","String","validRfcs","options","trim","toUpperCase","replace"],"mappings":"2OA6CiB,SAAXA,EAAYC,OAAOC,0DAA0B,IAA1BA,yBACnBC,EAAcF,IAAQG,EAAYH,GAAM,MAAO,OAnB7CI,EAO2BJ,EAa3BK,EAAS,GACTC,EAAiBC,EAAWC,KAAKR,GACjCS,GAAeH,IAvBfI,GADcV,EAwB+BA,GAvB/BW,MAAM,GAAI,GAAGA,OAAO,GAClCP,EAAOM,EAAQC,MAAM,EAAG,GACxBC,EAAQF,EAAQC,MAAM,EAAG,GACzBE,EAAMH,EAAQC,MAAM,EAAG,GACvBG,EAAO,IAAIC,iBAAUX,cAAQQ,cAASC,KACpCG,MAAMF,EAAKG,YAmBbC,GAAgBZ,IAfhBa,GAD2BnB,EAgBgCA,GAf/CW,OAAO,GACRS,EAAqBpB,KAClBmB,UAcfb,GAAgBD,EAAOgB,KA9CD,kBA+CtBZ,GAAcJ,EAAOgB,KA9CD,gBA+CpBH,GAAkBjB,GAAuBI,EAAOgB,KA9Cd,8BAiCf,SAACrB,GACnBsB,GAAUtB,GAAO,IAAIW,MAAM,EAAG,UAC7BY,EAAeC,SAASF,GAY3BG,CAAkBzB,IAAMK,EAAOgB,KA9CR,kBA+CpBhB,EASgB,SAAnBqB,EAAoB1B,SAAS,CACjC2B,SAAS,EACT3B,IAAAA,EACA4B,KALuBC,EAAR7B,EAKDA,IAL+B8B,EAAoB9B,EAAI+B,SAAW,MC9DlF,IAAMC,EAAa,GACZ,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,IDvCDZ,ECgDW,SAACa,GAIVC,GAAO,MAHgB,KAAjBD,EAAMF,kBAAoBE,GAAUA,GAC/BtB,MAAM,GAAI,GAROwB,MAAM,IAAIC,UAAUC,OAAO,SAACC,EAAKC,EAAMC,UAGlEF,GADON,EAAWO,IAAS,IADpBC,EAAI,IAGjB,IAM6B,UAClB,IAARN,EAAmB,IACX,IAARA,EAAmB,IAChBO,OAAOP,IDtDVX,mSACAmB,+EAEAnC,EAAa,6CAKbuB,EAAsB,IACpB,aACA,UAEFD,EAAgB,eACH,wBACA,WA2Cb3B,EAAgB,SAACF,UAAQA,KAAO6B,GAEhC1B,EAAc,SAACH,UAAQ0C,EAAUlB,SAASxB,WAiB/B,SAACiC,EAAOU,GACjB3C,EA3DCyC,OA2DgBR,GA1DpBW,OACAC,cACAC,QAAQ,kBAAmB,IAyDxBzC,EAASN,EAASC,EAAK2C,UACK,IAAlBtC,EAAO0B,OAENL,EAAiB1B,GAZI,CACtC2B,SAAS,EACT3B,IAAK,KACL4B,KAAM,KACNvB,OAQ4DA"}